# appearance
source ~/.mutt/mutt-colors-solarized/mutt-colors-solarized-dark-16.muttrc

# mailbox configuration
set mbox_type=maildir
set folder = "~/.maildir/"
set mask = "^\\.[^.]"
set spoolfile = "~/.maildir/"
set record = "+.Sent"
set postponed = "+.Drafts"

# set header_cache = ~/.mutt/cache/

# sendmail
set sendmail = ~/Programs/bin/sendmail.sh
set use_from = yes
set envelope_from = yes
set user_agent = yes

# addresses and mailing lists
alternates mark@stillwell.me marklee@fortawesome.org 
alternates m.stillwell@cranfield.ac.uk m.stillwell@imperial.ac.uk 
alternates mark.stillwell@ens-lyon.fr markls@hawaii.edu 
alternates mark_lee_stillwell@yahoo.com
subscribe simgrid-user@lists.gforge.inria.fr
subscribe simgrid-devel@lists.gforge.inria.fr
subscribe simgrid-private@lists.gforge.inria.fr
subscribe infra-songs--wp4@lists.gforge.inria.fr

# index 
set date_format = "%y-%m-%d"
set index_format = "%5C %Z %d %?M?(#%03M)&(%4c)? %-20.20L %s"
set sort = 'threads'
set sort_aux = 'reverse-last-date-received'
set collapse_unread = yes
set auto_tag = yes
set mark_old = no
folder-hook . 'exec collapse-all'

# read options
hdr_order Date From To Cc
alternative_order text/plain text/enriched text/html
auto_view text/html 
set implicit_autoview = yes
#set display_filter = "fold -sw 80"
#macro pager \cb <pipe-entry>'urlscan'<enter> 'Follow links with urlscan' 
#macro pager \cb <pipe-entry>'w3m'<enter> 'Follow links in w3m' 

# address book
set query_command = 'addr_lookup.sh %s'
set alias_file = ~/.mutt/aliases
source ~/.mutt/aliases

# compose options
set edit_headers = yes
#set editor_headers = "From: To: Cc: Bcc: Subject: Attach:"
set editor = "vim"
set autoedit = yes
set include = yes
bind editor <Tab> complete-query
bind editor ^T complete
bind editor <space> noop 

# encryption
source ~/.mutt/smime.rc
source ~/.mutt/gpg.rc
set crypt_replysign = yes
set crypt_replyencrypt = yes
set crypt_replysignencrypted = yes
set crypt_verify_sig = yes
message-hook '!~g !~G ~b "^-----BEGIN PGP (SIGNED )?MESSAGE"' 'exec check-traditional-pgp'

# account specific compose
# FIXME: not totally smooth
# FIXME: reply hook doesn't work if there are other recipients...
#source ~/.mutt/accounts/cranfield.rc
bind index,pager m noop
macro index,pager Af "<enter-command>source ~/.mutt/accounts/fortawesome.rc\n" "fortawesome"
macro index,pager Ac "<enter-command>source ~/.mutt/accounts/cranfield.rc\n" "cranfield"
macro index,pager mf "<enter-command>source ~/.mutt/accounts/fortawesome.rc\n<mail>" "fortawesome compose"
macro index,pager mc "<enter-command>source ~/.mutt/accounts/cranfield.rc\n<mail>" "cranfield compose"
reply-hook "~t m.stillwell@cranfield.ac.uk" "source ~/.mutt/accounts/cranfield.rc"
reply-hook "~t marklee@fortawesome.org" "source ~/.mutt/accounts/fortawesome.rc"

macro index       gi "<change-folder>+INBOX<enter>" "go to inbox"
macro index       gp "<change-folder>+Pending<enter>" "go to pending"
macro index       gd "<change-folder>+Drafts<enter>" "go to drafts"
macro index       gs "<change-folder>+Search<enter>" "go to cached search results"
macro index,pager d "<enter-command>unset trash\n<delete-message>" "archive message"
macro index,pager S "<enter-command>set trash=+Spam\n<delete-message>" "message to spam"
macro index,pager Mi "<copy-message>+INBOX<enter>" "copy to inbox"
macro index,pager Mp "<copy-message>+Pending<enter>" "copy to pending"
macro index,pager / "<enter-command>unset wait_key<enter><shell-escape>rlwrap -H ~/.mutt/search_history -s 100 -P 'd:1y- ' /bin/bash -c \"read -p 'search query: ' QUERY; mairix -t \\\${QUERY}\"<enter><change-folder-readonly>+Search<enter>" "notmuch: search mail"
