# appearance
source ~/.mutt/mutt-colors-solarized/mutt-colors-solarized-dark-16.muttrc

# mailbox configuration
set mbox_type = maildir
set header_cache = ~/.mutt/cache/
set mbox = "~/.maildir"
set folder = "~/.maildir"
set mask = ".*"
set spoolfile = "~/.maildir/"
set record = "+.Sent"
set postponed = "+.Drafts"

mailboxes ! + `\
for file in ~/.maildir/.*; do \
box=$(basename "$file"); \
if [ ! "$box" = '.' -a ! "$box" = '..' -a ! "$box" = '.customflags' \
   -a ! "$box" = '.subscriptions' ]; then \
 echo -n "\"+$box\" "; \
fi; \
done`

macro index c "<change-folder>?<toggle-mailboxes>" "open a different folder"
macro pager c "<change-folder>?<toggle-mailboxes>" "open a different folder"

# index 
set date_format = "%y-%m-%d"
set index_format = "%5C %Z %d %?M?(#%03M)&(%4c)? %-20.20L %s"
set sort = threads
set sort_aux = 'reverse-last-date-received'
set collapse_unread = yes
set auto_tag = yes
set mark_old = no
folder-hook . 'exec collapse-all'

# addresses and mailing lists
alternates mark@stillwell.me marklee@fortawesome.org 
alternates m.stillwell@cranfield.ac.uk m.stillwell@imperial.ac.uk 
alternates mark.stillwell@ens-lyon.fr markls@hawaii.edu 
alternates mark_lee_stillwell@yahoo.com mark.lee.stillwell@gmail.com
subscribe simgrid-user@lists.gforge.inria.fr
subscribe simgrid-devel@lists.gforge.inria.fr
subscribe simgrid-private@lists.gforge.inria.fr
subscribe infra-songs--wp4@lists.gforge.inria.fr

# read options
hdr_order From Resent-From Reply-To Date From To Cc
alternative_order text/plain text/enriched text/html
auto_view text/html 
set implicit_autoview = yes
#set display_filter = "fold -sw 80"
macro pager \cb <pipe-entry>'urlscan'<enter> 'Follow links with urlscan' 
macro pager \cb <pipe-entry>'w3m'<enter> 'Follow links in w3m' 

# multi-account
source ~/.mutt/accounts/stillwell.rc
macro index,pager m '<enter-command>source ~/.mutt/accounts/stillwell.rc<enter><mail>'
reply-hook "~t .@stillwell.me" "source ~/.mutt/accounts/stillwell.rc"
message-hook "~t .@stillwell.me" "source ~/.mutt/accounts/stillwell.rc"
reply-hook "~t marklee@fortawesome.org" "source ~/.mutt/accounts/fortawesome.rc"
message-hook "~t marklee@fortawesome.org" "source ~/.mutt/accounts/fortawesome.rc"
reply-hook "~t m.stillwell@imperial.ac.uk" "source ~/.mutt/accounts/imperial.rc"
message-hook "~t m.stillwell@imperial.ac.uk" "source ~/.mutt/accounts/imperial.rc"

# compose options
set edit_headers = yes
set editor = "vim"
set autoedit = yes
set include = yes
set text_flowed = yes
bind editor <Tab> complete-query
bind editor ^T complete
bind editor <space> noop 
set postpone = ask-yes

# address book
set alias_file = ~/.mutt/aliases
set sort_alias = alias
source $alias_file
set query_command = 'lbdbq %s'
macro generic,index,pager \ca "<shell-escape>abook<return>" "launch abook"
#macro index,pager A "<pipe-message>abook --add-email<return>" "add the sender address to abook"
macro index,pager A "<pipe-message>lbdb-fetchaddr -a<return>" "add the address to lbdb"

# encryption
source ~/.mutt/smime.rc
source ~/.mutt/gpg.rc
set crypt_replysign = yes
set crypt_replyencrypt = yes
set crypt_replysignencrypted = yes
set crypt_verify_sig = yes
message-hook '!~g !~G ~b "^-----BEGIN PGP (SIGNED )?MESSAGE"' 'exec check-traditional-pgp'

# sendmail
set sendmail = msmtp-enqueue.sh
set use_from = yes
set envelope_from = yes
set user_agent = yes

# archive and search
macro index,pager d "<save-message>=.Archive\n<enter>" "archive message"
macro index,pager S "<save-message>=.Spam\n<enter>" "message to spam"
macro index,pager Mi "<copy-message>=<enter>" "copy to inbox"
macro index,pager Mp "<copy-message>=.Pending<enter>" "copy to pending"
macro index,pager <F8> "<enter-command>unset wait_key<enter><shell-escape>notmuch-mutt -p -o ~/.maildir/.Search search<enter><change-folder-readonly>=.Search<enter>" "notmuch: search mail"

# movement macros
macro index       gi "<change-folder>+<enter>" "go to inbox"
macro index       ga "<change-folder>+.Archive<enter>" "go to archive"
macro index       gp "<change-folder>+.Pending<enter>" "go to pending"
macro index       gd "<change-folder>+.Drafts<enter>" "go to drafts"
macro index       gs "<change-folder>+.Search<enter>" "go to cached search results"
